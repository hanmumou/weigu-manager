<template>
  <div class="app-container">
    <div class="selgdscoll-from">
      <el-form :inline="true" class="demo-form-inline">
        <!-- <el-radio :label="3" @change="toggleSelection(tableData3)">全选</el-radio> -->
        <el-button class="select-all" @click="toggleSelection(tableData3)">全选表格</el-button>
        <div class="export">
          <el-button size="medium" type="primary" @click="exportExcel">导出会员列表</el-button>
        </div>
        <el-form-item label="所在区域：">
          <el-input/>
        </el-form-item>
        <el-form-item label="选择产品">
          <el-select placeholder="全部">
            <el-option label="全部"/>
            <el-option label="消费金额"/>
            <el-option label="注册时间"/>
          </el-select>
        </el-form-item>
        <el-date-picker
          type="date"
          format="yyyy-MM-d"
          value-format="yyyy-MM-d"
          placeholder="开始日期"/>
        <span>&nbsp;</span>
        <el-date-picker
          type="date"
          format="yyyy-MM-d"
          value-format="yyyy-MM-d"
          placeholder="结束时间"/>
        <span>&nbsp;</span>
        <el-button type="primary">查询</el-button>
      </el-form>
    </div>
    <div class="sellg-table">
      <el-table
        id="#exportexcel"
        ref="multipleTable"
        :data="tableData3"
        :row-class-name="tableRoWClassName"
        :summary-method="getsellgods"
        show-summary="true"
        tooltip-effect="dark"
        border
        style="width:100%"
        @selection-change="handleSelectionChange">
        <el-table-column
          type="selection"
          align="center"/>
        <el-table-column
          prop="name"
          label="商品ID"
          align="center"/>
        <el-table-column
          prop="name"
          label="产品昵称"
          align="center"/>
        <el-table-column
          prop="address"
          align="center"
          label="单价"/>
        <el-table-column
          prop="phone"
          align="center"
          label="规格"/>
        <el-table-column
          prop="mount"
          align="center"
          label="数量"/>
        <el-table-column
          prop="money"
          align="center"
          label="合计"/>
      </el-table>
    </div>

  </div>
</template>

<script>
import FileSaver from 'file-saver'
import XLSX from 'xlsx'
export default {
  data() {
    return {
      tableData3: [{
        date: '322',
        name: '进口的大菠萝',
        address: '120',
        phone: '绿色/100斤',
        mount: '10',
        money: '1200'
      },
      {
        date: '322',
        name: '进口的大菠萝',
        address: '120',
        phone: '绿色/100斤',
        mount: '10',
        money: '1200'
      },
      {
        date: '322',
        name: '进口的大菠萝',
        address: '120',
        phone: '绿色/100斤',
        mount: '10',
        money: '1200'
      },
      {
        date: '322',
        name: '进口的大菠萝',
        address: '120',
        phone: '绿色/100斤',
        mount: '10',
        money: '1200'
      },
      {
        date: '322',
        name: '进口的大菠萝',
        address: '120',
        phone: '绿色/100斤',
        mount: '10',
        money: '1200'
      },
      {
        date: '322',
        name: '进口的大菠萝',
        address: '120',
        phone: '绿色/100斤',
        mount: '10',
        money: '1200'
      },
      {
        date: '322',
        name: '进口的大菠萝',
        address: '120',
        phone: '绿色/100斤',
        mount: '10',
        money: '1200'
      }],
      multipleSelection: []
    }
  },

  methods: {
    // 表格隔行显示不同颜色
    tableRoWClassName({ row, rowIndex }) {
      if ((rowIndex % 2) === 1) {
        return 'success-row'
      } else if ((rowIndex % 2) === 0) {
        return 'warning-row'
      }
    },
    // 表格全选操作
    toggleSelection(rows) {
      if (rows) {
        rows.forEach(row => {
          this.$refs.multipleTable.toggleRowSelection(row)
        })
      } else {
        this.$refs.multipleTable.clearSelection()
      }
    },
    // 取消选择操作
    handleSelectionChange(val) {
      this.multipleSelection = val
    },
    // 合计操作

    // 导出Excel
    exportExcel() {
      /* generate workbook object from table */
      const wb = XLSX.utils.table_to_book(document.getElementById('#exportexcel'))
      /* get binary string as output */
      const wbout = XLSX.write(wb, { bookType: 'xlsx', bookSST: true, type: 'array' })
      try {
        FileSaver.saveAs(new Blob([wbout], { type: 'application/octet-stream' }), '会员列表.xlsx')
      } catch (e) {
        if (typeof console !== 'undefined') {
          console.log(e, wbout)
        }
      }
      return wbout
    },
    // 合计操作
    getsellgods(param) {
      const { columns, data } = param
      const sums = []
      columns.forEach((column, index) => {
        // 总计行的修改
        if (index <= 3) {
          sums[index] = ''
          return
        }
        if (index === 5) {
          sums[index] = '总价'
          return
        }
        const values = data.map(item => Number(item[column.property]))
        if (!values.every(value => isNaN(value))) {
          sums[index] = values.reduce((prev, curr) => {
            const value = Number(curr)
            if (!isNaN(value)) {
              return prev + curr
            } else {
              return prev
            }
          }, 0)
          sums[index] += ' 元'
        }
      })

      return sums
    }
  }
}
</script>
<style>
 .export{
   display: inline;
 }
 .selgdscoll-from{
   padding-top: 20px;
   padding-left: 82px;
   padding-bottom: 40px;
   width: 100%;
   background:rgb(48, 65, 86);
 }
.selgdscoll-from .el-form-item__label{
  color:#fff;
}
.el-table .warning-row {
  background: #FDEEE4;
}

.el-table .success-row {
  background: #FFFFFF;
}
.select-all{
  margin-right: 30px;
}
</style>

